syntax = "proto3";

package cato.db;
option go_package = "github.com/ncuhome/cato/generated";

import "cato/proto/struct.proto";


enum DbTypeEnum {
  CATO_DB_TYPE_INVALID = 0;
  CATO_DB_TYPE_MYSQL = 1;
  CATO_DB_TYPE_POSTGRESQL = 2;
  CATO_DB_TYPE_SQLITE3 = 3;
}

message DbOption {
  string name = 1;
  DbTypeEnum db_type = 2;
}

message DdlOptions {
  string sql_type = 1;
  string location = 2;
  MysqlImplDdlOpt mysql_impl_opt = 3;
}

message MysqlImplDdlOpt {
  string charset = 1;
  string comment = 2;
  string engine = 3;
}

message TableNameOption {
  string simple_name = 1;
  bool lazy_name = 2;
}

message TableOption {
  TableNameOption name_option = 1;
  cato.struct.FieldMapper field_mapper = 2;
}

enum DBKeyType {
  CATO_DB_KEY_TYPE_NO_KEY = 0;
  CATO_DB_KEY_TYPE_INDEX = 1;
  CATO_DB_KEY_TYPE_UNIQUE = 2;
  CATO_DB_KEY_TYPE_COMBINE = 3;
  CATO_DB_KEY_TYPE_PRIMARY = 4;
}

message DBKey {
  string key_name = 1;
  DBKeyType key_type = 2;
}

message TimeOption {
  bool unix_to_time = 1;
  string time_format = 2;
}

message ColumnDescriptor {
  string field_type = 1;
  string field_name = 2;
  bool nullable = 3;
  string default = 4;
  string comment = 5;
  // col_group will merge field into func Get{{GroupName}}Cols() []string
  // for example:
  //     string a = 1; // field_name = "col_a", col_group = "example"
  //     string b = 2; // field_name = "col_b", col_group = "example"
  // and the generated dto struct
  // will has
  //  func GetExampleCols() []string {return []string{"col_a", "col_b"}}
  string col_group = 6;
  bool auto_incr = 7;
}

message JsonTransOption {
  bool lazy_load = 1;
}

message ColumnOption {
  JsonTransOption json_trans = 1;
  TimeOption time_option = 2;
  ColumnDescriptor col_desc = 3;
  repeated DBKey keys = 4;
  repeated cato.struct.FieldTag tags = 5;
}